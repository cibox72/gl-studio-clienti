<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>G&L Studio - Gestione Clienti</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<style>
:root {
--primary-color: #e63946;
--secondary-color: #1d3557;
--light-color: #f1faee;
--gray-color: #8d99ae;
--border-radius: 8px;
--box-shadow: 0 4px 6px rgba(0,0,0,0.1);
}
* {
margin: 0;
padding: 0;
box-sizing: border-box;
font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}
body {
background-color: #f8f9fa;
color: #333;
padding: 20px;
max-width: 1400px;
margin: 0 auto;
}
.header {
text-align: center;
margin-bottom: 25px;
padding: 15px;
border-bottom: 3px solid var(--primary-color);
}
.header h1 {
color: var(--secondary-color);
font-size: 28px;
margin-bottom: 8px;
}
.header p {
color: var(--gray-color);
font-size: 16px;
}
.nav-buttons {
display: flex;
justify-content: center;
gap: 15px;
margin-bottom: 30px;
flex-wrap: wrap;
}
.nav-btn {
padding: 12px 25px;
background-color: var(--secondary-color);
color: white;
border: none;
border-radius: var(--border-radius);
font-size: 16px;
cursor: pointer;
transition: all 0.3s;
}
.nav-btn:hover {
background-color: #0d2340;
transform: translateY(-2px);
}
.nav-btn.logout {
background-color: var(--primary-color);
}
.nav-btn.logout:hover {
background-color: #c1272d;
}
.form-section {
background: white;
border-radius: var(--border-radius);
box-shadow: var(--box-shadow);
padding: 25px;
margin-bottom: 30px;
}
.section-title {
text-align: center;
color: var(--secondary-color);
font-size: 22px;
margin-bottom: 25px;
padding-bottom: 10px;
border-bottom: 2px solid var(--gray-color);
}
.client-container {
display: grid;
grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
gap: 30px;
margin-bottom: 30px;
}
.client-box {
background: #fafafa;
padding: 20px;
border-radius: var(--border-radius);
border: 1px solid #ddd;
}
.client-box h3 {
color: var(--secondary-color);
margin-bottom: 15px;
font-size: 18px;
display: flex;
align-items: center;
gap: 8px;
}
.client-fields {
display: grid;
grid-template-columns: 1fr 1fr;
gap: 15px;
}
.full-width {
grid-column: span 2;
}
.field-group {
margin-bottom: 15px;
}
.field-group label {
display: block;
margin-bottom: 6px;
font-weight: 500;
color: var(--secondary-color);
}
.field-group input,
.field-group select,
.field-group textarea {
width: 100%;
padding: 10px 12px;
border: 1px solid #ddd;
border-radius: 6px;
font-size: 15px;
}
.field-group textarea {
min-height: 80px;
resize: vertical;
}
.maps-btn {
background-color: #4285f4;
color: white;
border: none;
border-radius: 6px;
padding: 8px 12px;
cursor: pointer;
margin-left: 8px;
font-size: 14px;
transition: background-color 0.2s;
}
.maps-btn:hover {
background-color: #3367d6;
}
.whatsapp-btn {
background-color: #25D366;
color: white;
border: none;
border-radius: 6px;
padding: 8px 12px;
cursor: pointer;
margin-left: 8px;
font-size: 14px;
transition: background-color 0.2s;
}
.whatsapp-btn:hover {
background-color: #128C7E;
}
.service-grid {
display: grid;
grid-template-columns: repeat(3, 1fr);
gap: 20px;
margin-bottom: 25px;
}
.service-item {
display: flex;
flex-direction: column;
gap: 8px;
}
.service-item select,
.service-item input[type="number"] {
width: 100%;
padding: 10px;
border: 1px solid #ddd;
border-radius: 6px;
font-size: 14px;
}
.highlight-line {
text-align: center;
color: var(--primary-color);
font-weight: bold;
font-size: 20px;
margin: 25px 0;
padding: 12px;
background-color: rgba(230, 57, 70, 0.08);
border-radius: var(--border-radius);
letter-spacing: 1px;
}
.amount-section {
text-align: center;
margin: 30px 0;
}
#importoTotale {
width: 100%;
max-width: 400px;
margin: 0 auto;
padding: 18px;
font-size: 32px;
font-weight: bold;
color: var(--primary-color);
border: 3px solid var(--primary-color);
border-radius: 12px;
background-color: rgba(230, 57, 70, 0.05);
text-align: center;
letter-spacing: 1px;
}
.action-buttons {
display: flex;
justify-content: center;
gap: 15px;
margin-top: 25px;
flex-wrap: wrap;
}
.action-btn {
padding: 14px 28px;
border: none;
border-radius: var(--border-radius);
font-size: 16px;
font-weight: 600;
cursor: pointer;
transition: all 0.3s;
display: flex;
align-items: center;
gap: 8px;
}
.save-btn {
background-color: var(--primary-color);
color: white;
}
.save-btn:hover {
background-color: #c1272d;
transform: scale(1.03);
}
.deposit-section {
margin-top: 25px;
padding-top: 20px;
border-top: 2px dashed #ddd;
}
.deposit-item {
display: flex;
align-items: center;
gap: 15px;
padding: 12px;
background-color: #f9f9f9;
border-radius: 8px;
margin-bottom: 12px;
}
.deposit-item input {
flex: 1;
padding: 8px 12px;
border: 1px solid #ddd;
border-radius: 6px;
font-size: 15px;
}
.deposit-btn {
padding: 8px 15px;
background-color: #4CAF50;
color: white;
border: none;
border-radius: 6px;
cursor: pointer;
}
.deposit-btn.delete {
background-color: #f44336;
}
.deposit-btn.edit {
background-color: #2196F3;
}
.deposit-btn:hover {
opacity: 0.9;
}
.balance-line {
text-align: center;
font-size: 24px;
font-weight: bold;
color: var(--primary-color);
margin: 25px 0;
padding: 15px;
background-color: rgba(230, 57, 70, 0.1);
border-radius: var(--border-radius);
letter-spacing: 1px;
}
.client-list {
display: grid;
gap: 15px;
margin-top: 30px;
}
.client-card {
background: white;
border-radius: var(--border-radius);
box-shadow: var(--box-shadow);
padding: 20px;
cursor: pointer;
transition: transform 0.2s;
border-left: 5px solid var(--secondary-color);
}
.client-card:hover {
transform: translateX(5px);
}
.client-card-header {
display: flex;
justify-content: space-between;
align-items: center;
margin-bottom: 15px;
flex-wrap: wrap;
gap: 10px;
}
.client-card-title {
font-size: 18px;
font-weight: bold;
color: var(--secondary-color);
}
.client-card-date {
background-color: var(--primary-color);
color: white;
padding: 4px 10px;
border-radius: 20px;
font-size: 14px;
font-weight: bold;
}
.client-card-service {
color: var(--gray-color);
font-size: 15px;
margin-bottom: 10px;
}
.client-card-amounts {
display: flex;
justify-content: space-between;
font-size: 16px;
margin-top: 15px;
flex-wrap: wrap;
gap: 10px;
}
.client-card-total {
font-weight: bold;
color: var(--primary-color);
}
.client-card-deposits {
color: #4CAF50;
font-weight: 500;
}
.client-card-balance {
font-weight: bold;
color: var(--primary-color);
}
.card-buttons {
display: flex;
justify-content: flex-end;
gap: 10px;
margin-top: 15px;
flex-wrap: wrap;
}
.card-btn {
padding: 8px 15px;
border: none;
border-radius: 6px;
font-size: 14px;
cursor: pointer;
display: flex;
align-items: center;
gap: 6px;
}
.card-btn.whatsapp {
background-color: #25D366;
color: white;
}
.card-btn.edit {
background-color: #2196F3;
color: white;
}
.card-btn.delete {
background-color: #f44336;
color: white;
}
.card-btn.pdf {
background-color: #6c757d;
color: white;
}
.card-btn.open {
background-color: #1976d2;
color: white;
}
.card-btn.add-deposit {
background-color: #4CAF50;
color: white;
}
.card-btn:hover {
opacity: 0.9;
}
.search-container {
margin: 25px 0;
text-align: center;
}
#searchInput {
padding: 12px 20px;
width: 100%;
max-width: 500px;
border: 2px solid #ddd;
border-radius: 30px;
font-size: 16px;
outline: none;
transition: border-color 0.3s;
}
#searchInput:focus {
border-color: var(--primary-color);
}
.app-gallery {
background-color: #f8f9fa;
padding: 25px;
border-radius: var(--border-radius);
margin-top: 25px;
}
.gallery-grid {
display: grid;
grid-template-columns: repeat(3, 1fr);
gap: 20px;
margin-top: 15px;
}
.gallery-item.full {
grid-column: span 3;
}
.extra-section {
background-color: #f0f8ff;
padding: 20px;
border-radius: 12px;
margin: 25px 0;
}
.extra-title {
text-align: center;
font-size: 20px;
font-weight: bold;
color: var(--secondary-color);
margin-bottom: 20px;
}

/* MODALE AGGIUNGI ACCONTO */
#modalAcconto {
display: none;
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 100%;
background: rgba(0,0,0,0.5);
z-index: 1000;
justify-content: center;
align-items: center;
}
.modal-content {
background: white;
padding: 25px;
border-radius: 12px;
width: 90%;
max-width: 400px;
box-shadow: 0 6px 20px rgba(0,0,0,.2);
}
.modal-content h3 {
margin-top: 0;
color: var(--primary-color);
}
.modal-input {
width: 100%;
padding: 10px;
margin: 10px 0;
border: 1px solid #ccc;
border-radius: 6px;
font-size: 15px;
}
.modal-buttons {
margin-top: 20px;
text-align: right;
}
.modal-btn {
padding: 8px 16px;
border: none;
border-radius: 6px;
cursor: pointer;
margin-left: 8px;
font-size: 14px;
}
.btn-cancel {
background: #999;
color: white;
}
.btn-save {
background: var(--primary-color);
color: white;
}

/* SCHEDA PDF-LIKE */
.pdf-view {
background: white;
padding: 30px;
margin: 20px auto;
max-width: 900px;
border: 1px solid #ddd;
border-radius: 12px;
box-shadow: 0 4px 12px rgba(0,0,0,0.1);
display: none;
}
.pdf-view h2 {
color: var(--secondary-color);
text-align: center;
margin-bottom: 20px;
}
.pdf-section {
margin-bottom: 20px;
}
.pdf-section h3 {
color: var(--secondary-color);
margin-bottom: 10px;
border-bottom: 1px solid #eee;
padding-bottom: 5px;
}
.pdf-row {
display: flex;
flex-wrap: wrap;
margin-bottom: 8px;
}
.pdf-label {
font-weight: bold;
width: 200px;
}
.pdf-value {
flex: 1;
}

@media (max-width: 1100px) {
.service-grid {
grid-template-columns: repeat(2, 1fr);
}
.client-container,
.gallery-grid {
grid-template-columns: 1fr;
}
.client-fields {
grid-template-columns: 1fr;
}
}
@media (max-width: 768px) {
.service-grid {
grid-template-columns: 1fr;
}
.action-buttons,
.nav-buttons {
flex-direction: column;
align-items: center;
}
.action-btn,
.nav-btn {
width: 100%;
max-width: 300px;
}
#importoTotale {
font-size: 26px;
padding: 15px;
}
.balance-line {
font-size: 20px;
padding: 12px;
}
}
.hidden {
display: none;
}
.print-only {
display: none;
}
@media print {
body {
background-color: white;
padding: 0;
}
.nav-buttons,
.action-buttons,
.search-container,
.header,
.section-title,
.highlight-line,
.amount-section,
.deposit-section,
.app-gallery,
.balance-line,
.extra-section,
.pdf-view .pdf-actions {
display: none !important;
}
.form-section {
box-shadow: none;
padding: 0;
margin: 0;
}
.client-container {
grid-template-columns: 1fr !important;
gap: 20px;
}
.print-only {
display: block !important;
text-align: center;
margin-bottom: 20px;
font-size: 24px;
color: var(--secondary-color);
font-weight: bold;
}
.no-print {
display: none !important;
}
.client-card {
break-inside: avoid;
}
}
</style>
</head>
<body>
<div class="header">
<h1>G&L Studio</h1>
<p>Via Ciarrocco n.21, Canicatt√¨ (AG)</p>
</div>
<div class="nav-buttons">
<button class="nav-btn" onclick="location.href='dashboard.html'">üè† Dashboard</button>
<button class="nav-btn" onclick="downloadBackup()">üì• Backup Dati</button>
<button class="nav-btn" onclick="restoreBackup()">üì§ Ripristina da File</button>
<button class="nav-btn logout" onclick="location.href='logout.html'">üö™ Esci</button>
</div>
<div class="form-section">
<h2 class="section-title">Nuovo Cliente</h2>
<!-- CLIENTE 1 -->
<div class="client-container">
<div class="client-box">
<h3>üë§ Cliente 1 (Obbligatorio)</h3>
<div class="client-fields">
<div class="field-group">
<label for="cognome1">Cognome</label>
<input type="text" id="cognome1" required>
</div>
<div class="field-group">
<label for="nome1">Nome</label>
<input type="text" id="nome1" required>
</div>
<div class="field-group full-width">
<label for="indirizzo1">Indirizzo (Via, Citt√†)</label>
<div style="display: flex; gap: 10px; align-items: center;">
<input type="text" id="indirizzo1" placeholder="Via Roma, Canicatt√¨" style="flex: 1;">
<button type="button" class="maps-btn" onclick="openMaps('indirizzo1')">üìç</button>
</div>
</div>
<div class="field-group">
<label for="telefono1">Telefono</label>
<div style="display: flex; gap: 10px; align-items: center;">
<input type="text" id="telefono1" required style="flex: 1;">
<button type="button" class="whatsapp-btn" onclick="openWhatsAppWeb(document.getElementById('telefono1').value, document.getElementById('nome1').value + ' ' + document.getElementById('cognome1').value)">üí¨ WhatsApp</button>
</div>
</div>
<div class="field-group">
<label for="email1">Email</label>
<input type="email" id="email1">
</div>
</div>
</div>
<!-- CLIENTE 2 -->
<div class="client-box">
<h3>üë§ Cliente 2 (Opzionale)</h3>
<div class="client-fields">
<div class="field-group">
<label for="cognome2">Cognome</label>
<input type="text" id="cognome2">
</div>
<div class="field-group">
<label for="nome2">Nome</label>
<input type="text" id="nome2">
</div>
<div class="field-group full-width">
<label for="indirizzo2">Indirizzo (Via, Citt√†)</label>
<div style="display: flex; gap: 10px; align-items: center;">
<input type="text" id="indirizzo2" placeholder="Via Verdi, Palermo" style="flex: 1;">
<button type="button" class="maps-btn" onclick="openMaps('indirizzo2')">üìç</button>
</div>
</div>
<div class="field-group">
<label for="telefono2">Telefono</label>
<div style="display: flex; gap: 10px; align-items: center;">
<input type="text" id="telefono2" style="flex: 1;">
<button type="button" class="whatsapp-btn" onclick="openWhatsAppWeb(document.getElementById('telefono2').value, document.getElementById('nome2').value + ' ' + document.getElementById('cognome2').value)">üí¨ WhatsApp</button>
</div>
</div>
<div class="field-group">
<label for="email2">Email</label>
<input type="email" id="email2">
</div>
</div>
</div>
</div>
<!-- LAVORO COMMISSIONATO -->
<div class="highlight-line">LAVORO COMMISSIONATO</div>
<div style="display: flex; gap: 20px; margin-bottom: 20px; flex-wrap: wrap; align-items: center;">
<div class="field-group" style="flex: 1; min-width: 200px;">
<!-- ‚úÖ MENU PI√ô LUNGO PER "TIPO DI SERVIZIO" -->
<label for="tipoServizio">1. Tipo di Servizio</label>
<select id="tipoServizio" style="width: 100%; padding: 10px; border-radius: 6px; border: 1px solid #ddd; font-size: 15px; min-width: 220px;">
<option value="">Seleziona...</option>
<option value="Anniversario">Anniversario</option>
<option value="Compleanno">Compleanno</option>
<option value="Battesimo">Battesimo</option>
<option value="Comunione">Comunione</option>
<option value="Cresima">Cresima</option>
<option value="Percorso Catecumenale">Percorso Catecumenale</option>
<option value="Matrimonio">Matrimonio</option>
<option value="Maternity">Maternity</option>
<option value="New Born">New Born</option>
<option value="Maternity+New Born">Maternity+New Born</option>
<option value="Evento">Evento</option>
<option value="SOLO STAMPE">SOLO STAMPE</option>
</select>
</div>
<div class="field-group" style="flex: 1; min-width: 200px;">
<label for="dataEvento">4. Data Evento</label>
<input type="date" id="dataEvento" style="width: 100%; padding: 10px; border-radius: 6px; border: 1px solid #ddd; font-size: 15px;">
</div>
</div>
<div style="display: flex; gap: 20px; margin-bottom: 20px; flex-wrap: wrap; align-items: center;">
<div class="field-group" style="flex: 1; min-width: 200px;">
<label for="chiesa">2. Chiesa</label>
<div style="display: flex; gap: 10px; align-items: center;">
<input type="text" id="chiesa" style="flex: 1;">
<button type="button" class="maps-btn" onclick="openMaps('chiesa')">üìç</button>
</div>
</div>
<div class="field-group" style="flex: 1; min-width: 200px;">
<label for="location">3. Location</label>
<div style="display: flex; gap: 10px; align-items: center;">
<input type="text" id="location" style="flex: 1;">
<button type="button" class="maps-btn" onclick="openMaps('location')">üìç</button>
</div>
</div>
</div>
<!-- SERVIZI -->
<div class="service-grid">
<!-- Riga 1 -->
<div class="service-item">
<label for="album">5. Album</label>
<select id="album">
<option value="">Nessuno</option>
<option value="ANALOGICO 33x33 cm">ANALOGICO 33x33 cm</option>
<option value="DIGITALE 20x30 cm orizz.">DIGITALE 20x30 cm orizz.</option>
<option value="DIGITALE 25x35 cm orizz.">DIGITALE 25x35 cm orizz.</option>
<option value="DIGITALE 30x40 cm orizz.">DIGITALE 30x40 cm orizz.</option>
<option value="DIGITALE 35x45 cm orizz.">DIGITALE 35x45 cm orizz.</option>
<option value="SOLO STAMPE">SOLO STAMPE</option>
<option value="SERVIZIO SOLO FILES">SERVIZIO SOLO FILES</option>
</select>
</div>
<div class="service-item">
<label for="copertina">6. Copertina</label>
<select id="copertina">
<option value="">Nessuna</option>
<option value="Semplice con foto TELATA">Semplice con foto TELATA</option>
<option value="EXTRA LUSSO">EXTRA LUSSO</option>
</select>
</div>
<div class="service-item">
<label for="miniAlbum">7. Mini Album</label>
<select id="miniAlbum">
<option value="">Nessuno</option>
<option value="1">1</option>
<option value="2">2</option>
<option value="3">3</option>
<option value="4">4</option>
<option value="5">5</option>
<option value="6">6</option>
<option value="7">7</option>
<option value="8">8</option>
<option value="9">9</option>
<option value="10">10</option>
</select>
</div>
<!-- Riga 2 -->
<div class="service-item">
<label for="effetti">8. Effetti</label>
<select id="effetti">
<option value="">Nessuno</option>
<option value="SI">SI</option>
<option value="NO">NO</option>
</select>
</div>
<div class="service-item">
<label for="interni">9. Interni</label>
<select id="interni">
<option value="">Nessuno</option>
<option value="5">5</option>
<option value="10">10</option>
<option value="15">15</option>
<option value="20">20</option>
<option value="25">25</option>
<option value="30">30</option>
<option value="35">35</option>
<option value="40">40</option>
<option value="45">45</option>
<option value="50">50</option>
</select>
</div>
<div class="service-item">
<label for="fotoBook">10. Foto selezionate per book</label>
<select id="fotoBook">
<option value="">Nessuna</option>
<option value="10">10</option>
<option value="20">20</option>
<option value="30">30</option>
<option value="40">40</option>
<option value="50">50</option>
<option value="60">60</option>
<option value="70">70</option>
<option value="80">80</option>
<option value="90">90</option>
<option value="100">100</option>
<option value="110">110</option>
<option value="120">120</option>
<option value="130">130</option>
<option value="140">140</option>
<option value="150">150</option>
<option value="160">160</option>
<option value="170">170</option>
<option value="180">180</option>
<option value="190">190</option>
<option value="200">200</option>
<option value="210">210</option>
<option value="220">220</option>
<option value="230">230</option>
<option value="240">240</option>
<option value="250">250</option>
</select>
</div>
<!-- Riga 3 -->
<div class="service-item">
<label for="anteprima">11. Anteprima</label>
<select id="anteprima">
<option value="">Nessuna</option>
<option value="SOLO FOTO">SOLO FOTO</option>
<option value="SOLO VIDEO">SOLO VIDEO</option>
<option value="VIDEO E FOTO">VIDEO E FOTO</option>
</select>
</div>
<div class="service-item">
<label for="postServizio">12. Post Servizio</label>
<select id="postServizio">
<option value="">Nessuno</option>
<option value="SOLO FOTO">SOLO FOTO</option>
<option value="SOLO VIDEO">SOLO VIDEO</option>
<option value="FOTO E VIDEO">FOTO E VIDEO</option>
</select>
</div>
<div class="service-item">
<label for="video">13. Video</label>
<select id="video">
<option value="">Nessuno</option>
<option value="SOLO GIORNATA">SOLO GIORNATA</option>
<option value="GIORNATA+DRONE">GIORNATA+DRONE</option>
<option value="Giorn+Drone+Proiezione ANTEPRIMA">Giorn+Drone+Proiezione ANTEPRIMA</option>
<option value="Giorn.+Drone+Proiezione ANTEPRIMA+LIVE">Giorn.+Drone+Proiezione ANTEPRIMA+LIVE</option>
<option value="Giorn.+Drone+Proiezione LIVE">Giorn.+Drone+Proiezione LIVE</option>
</select>
</div>
<!-- Riga 4 -->
<div class="service-item">
<label for="tela">14. Tela</label>
<div style="display: flex; align-items: center; gap: 10px;">
<select id="tela" style="flex: 1; min-width: 150px;">
<option value="">Nessuna</option>
<option value="50x70 cm SOLO TELA">50x70 cm SOLO TELA</option>
<option value="50x70 cm CON TELAIO">50x70 cm CON TELAIO</option>
</select>
<select id="telaQt√†" style="width: 80px;">
<option value="">Qt√†</option>
<option value="1">1</option>
<option value="2">2</option>
<option value="3">3</option>
<option value="4">4</option>
<option value="5">5</option>
<option value="6">6</option>
<option value="7">7</option>
<option value="8">8</option>
<option value="9">9</option>
<option value="10">10</option>
</select>
</div>
</div>
<div class="service-item">
<label for="stampeCarta">15. Stampe Carta Fotografica</label>
<div style="display: flex; align-items: center; gap: 10px;">
<select id="stampeCarta" style="flex: 1; min-width: 150px;">
<option value="">Nessuna</option>
<option value="50x70 cm">50x70 cm</option>
<option value="30x40 cm">30x40 cm</option>
<option value="24x30 cm">24x30 cm</option>
<option value="20x30 cm">20x30 cm</option>
<option value="15x20 cm">15x20 cm</option>
</select>
<select id="stampeQt√†" style="width: 80px;">
<option value="">Qt√†</option>
<option value="1">1</option>
<option value="2">2</option>
<option value="3">3</option>
<option value="4">4</option>
<option value="5">5</option>
<option value="6">6</option>
<option value="7">7</option>
<option value="8">8</option>
<option value="9">9</option>
<option value="10">10</option>
<option value="20">20</option>
<option value="30">30</option>
<option value="40">40</option>
<option value="50">50</option>
<option value="60">60</option>
<option value="70">70</option>
<option value="80">80</option>
<option value="90">90</option>
<option value="100">100</option>
</select>
</div>
</div>
<div class="service-item">
<label for="miniPocket">16. Mini Pocket</label>
<select id="miniPocket">
<option value="">Nessuno</option>
<option value="1">1</option>
<option value="2">2</option>
<option value="3">3</option>
<option value="4">4</option>
<option value="5">5</option>
<option value="6">6</option>
<option value="7">7</option>
<option value="8">8</option>
<option value="9">9</option>
<option value="10">10</option>
</select>
</div>
</div>
<div class="service-grid">
<!-- Riga 5 -->
<div class="service-item">
<label for="servizioSalaPosa">17. Servizio Sala Posa</label>
<!-- ‚úÖ AGGIUNTA VOCE "Nessuno" -->
<select id="servizioSalaPosa">
<option value="">Nessuno</option>
<option value="INCLUSO">INCLUSO</option>
<option value="DA CONTEGGIARE">DA CONTEGGIARE</option>
</select>
</div>
<div class="service-item">
<label for="servizioLocation">18. Servizio Location</label>
<!-- ‚úÖ AGGIUNTA VOCE "Nessuno" -->
<select id="servizioLocation">
<option value="">Nessuno</option>
<option value="INCLUSO">INCLUSO</option>
<option value="DA CONTEGGIARE">DA CONTEGGIARE</option>
</select>
</div>
<div class="service-item"></div>
</div>

<!-- RICHIESTE EXTRA -->
<div class="extra-section">
<h3 class="extra-title">Richieste EXTRA</h3>
<div class="field-group">
<label for="fotoExtraBook">Foto extra in book</label>
<textarea id="fotoExtraBook" rows="2" placeholder="Descrivi le foto extra richieste..."></textarea>
</div>
<div class="field-group">
<label for="servizioExtra">Servizio extra</label>
<textarea id="servizioExtra" rows="2" placeholder="Descrivi eventuali servizi aggiuntivi..."></textarea>
</div>
<div class="field-group">
<label for="penninoUsb">Pennino USB</label>
<textarea id="penninoUsb" rows="2" placeholder="Specifiche sul pennino USB (capacit√†, contenuti, ecc.)..."></textarea>
</div>
</div><!-- IMPORTO E EXTRA -->
<div class="form-section" style="margin-top: 20px; padding: 20px; background-color: #f8f9fa; border-radius: 12px;">
  <h3 style="text-align: center; color: var(--secondary-color); margin-bottom: 20px;">üí∞ DETTAGLIO COSTI</h3>
  
  <!-- Riga 1: Importo servizio -->
  <div style="display: flex; gap: 20px; margin-bottom: 20px; flex-wrap: wrap;">
    <div class="field-group" style="flex: 1; min-width: 200px;">
      <label for="importoServizio">Importo Servizio (‚Ç¨)</label>
      <input type="text" id="importoServizio" placeholder="0,00 ‚Ç¨" oninput="calculateTotal()" style="width: 100%; padding: 10px; font-size: 16px; border: 2px solid #ddd; border-radius: 6px; text-align: right;">
    </div>
  </div>

  <!-- Riga 2: Importo EXTRA manuale -->
  <div style="display: flex; gap: 20px; margin-bottom: 20px; flex-wrap: wrap;">
    <div class="field-group" style="flex: 1; min-width: 200px;">
      <label for="importoExtraManuale">Importo EXTRA (‚Ç¨)</label>
      <input type="text" id="importoExtraManuale" placeholder="0,00 ‚Ç¨" oninput="calculateTotal()" style="width: 100%; padding: 10px; font-size: 16px; border: 2px solid #ddd; border-radius: 6px; text-align: right;">
    </div>
  </div>

  <!-- Riga 3: Totale complessivo -->
  <div style="text-align: center; margin-top: 20px; padding: 15px; background-color: rgba(230, 57, 70, 0.1); border-radius: 8px;">
    <strong style="font-size: 20px; color: var(--primary-color);">TOTALE COMPLESSIVO: ‚Ç¨ <span id="totaleComplessivo">0,00</span></strong>
  </div>
</div>

<!-- APP. GALLERY -->
<div class="app-gallery">
<h3 style="color: var(--secondary-color); margin-bottom: 15px;">APP. GALLERY</h3>
<div class="gallery-grid">
<div class="gallery-item">
<label for="galleryEmail">Email</label>
<input type="email" id="galleryEmail" placeholder="email@esempio.it" style="width: 100%; padding: 12px; font-size: 16px;">
</div>
<div class="gallery-item">
<label for="galleryUsername">Username</label>
<input type="text" id="galleryUsername" placeholder="Nome utente" style="width: 100%; padding: 12px; font-size: 16px;">
</div>
<div class="gallery-item">
<label for="galleryPassword">Password</label>
<input type="password" id="galleryPassword" placeholder="" style="width: 100%; padding: 12px; font-size: 16px;">
</div>
<div class="gallery-item full">
<label for="galleryUrl">URL</label>
<input type="url" id="galleryUrl" placeholder="https://" style="width: 100%; padding: 12px; font-size: 16px;">
</div>
</div>
</div>
<!-- CARTELLA SERVIZIO -->
<div class="field-group" style="margin-top: 20px;">
<label for="cartellaServizio">Cartella servizio in:</label>
<input type="text" id="cartellaServizio" placeholder="Incolla qui il percorso della cartella" style="width: 100%; padding: 12px; font-size: 16px;">
</div>
<!-- NOTA -->
<div class="field-group" style="margin-top: 20px;">
<label for="nota">NOTA</label>
<textarea id="nota" rows="4" style="resize: none; width: 100%; padding: 12px; font-size: 16px;"></textarea>
</div>
<!-- ACCONTI -->
<div class="deposit-section">
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
<h3 style="color: var(--secondary-color);">Acconti Ricevuti</h3>
<button class="deposit-btn" onclick="addDeposit()">+ Aggiungi Acconto</button>
</div>
<div id="depositList"></div>
</div>
<!-- SALDO RESIDUO -->
<div class="balance-line" id="saldoResiduo">SALDO RESIDUO: ‚Ç¨ 0,00</div>
<!-- PULSANTI AZIONE -->
<div class="action-buttons">
<button class="action-btn save-btn" onclick="saveClient()">‚úÖ SALVA CLIENTE</button>
</div>
</div>
<!-- LISTA CLIENTI -->
<div class="search-container">
<input type="text" id="searchInput" placeholder="üîç Cerca cliente per nome o cognome..." onkeyup="filterClients()">
</div>
<div class="form-section">
<h2 class="section-title">Archivio Clienti</h2>
<div class="client-list" id="clientList"></div>
</div>

<!-- SCHEDA PDF-LIKE -->
<div class="pdf-view" id="pdfView">
  <h2>SCHEDA CLIENTE</h2>
  <div id="pdfContent"></div>
  <div class="pdf-actions" style="text-align: center; margin-top: 20px;">
    <button class="card-btn edit" onclick="editFromPdfView()">‚úèÔ∏è Modifica</button>
    <button class="card-btn pdf" onclick="printPdfView()">üñ®Ô∏è Stampa</button>
  </div>
</div>

<!-- MODALE AGGIUNGI ACCONTO -->
<div id="modalAcconto" class="hidden">
  <div class="modal-content">
    <h3>‚ûï Aggiungi Acconto</h3>
    <input type="date" id="modalData" class="modal-input" style="width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ccc; border-radius: 6px; font-size: 15px;">
    <input type="text" id="modalImporto" class="modal-input" placeholder="Importo (‚Ç¨)" style="width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ccc; border-radius: 6px; font-size: 15px;">
    <div class="modal-buttons">
      <button class="modal-btn btn-cancel" onclick="closeModal()">Annulla</button>
      <button class="modal-btn btn-save" onclick="saveNewDeposit()">Salva</button>
    </div>
  </div>
</div>

<script>
// Inizializzazione jsPDF
const { jsPDF } = window.jspdf;
let currentClientId = null;
let isEditing = false;

// Carica clienti all'avvio
document.addEventListener('DOMContentLoaded', function() {
loadClients();
});

// ‚úÖ FUNZIONE: formatta data ISO (YYYY-MM-DD) in gg/mm/aaaa
function formatDateISOtoDDMMYYYY(isoDate) {
if (!isoDate) return '';
const [y, m, d] = isoDate.split('-');
return `${d}/${m}/${y}`;
}

// Apri modale per aggiungere acconto
function openAddDepositModal(clientId) {
currentClientId = clientId;
document.getElementById('modalData').value = '';
document.getElementById('modalImporto').value = '';
document.getElementById('modalAcconto').classList.remove('hidden');
}

// Chiudi modale
function closeModal() {
document.getElementById('modalAcconto').classList.add('hidden');
currentClientId = null;
}

// Salva nuovo acconto
function saveNewDeposit() {
const dataISO = document.getElementById('modalData').value;
const importoText = document.getElementById('modalImporto').value.trim().replace('‚Ç¨', '').replace(/\./g, '').replace(',', '.');

if (!dataISO || !importoText) {
alert('‚ö†Ô∏è Compila entrambi i campi');
return;
}

const importo = parseFloat(importoText);
if (isNaN(importo) || importo <= 0) {
alert('‚ö†Ô∏è Inserisci un importo valido');
return;
}

const dataFormatted = formatDateISOtoDDMMYYYY(dataISO);

const clients = JSON.parse(localStorage.getItem('glStudioClients')) || [];
const clienteIndex = clients.findIndex(c => c.id === currentClientId);

if (clienteIndex !== -1) {
clients[clienteIndex].acconti.push({
  date: dataFormatted,
importo: importo.toFixed(2)
});
localStorage.setItem('glStudioClients', JSON.stringify(clients));
alert('‚úÖ Acconto aggiunto con successo!');
loadClients();

if (document.getElementById('pdfView').style.display !== 'none') {
showPdfView(currentClientId);
}
} else {
alert('‚ùå Cliente non trovato');
}
closeModal();
}

// ‚úÖ AGGIUNGI ACCHI NEL MODULO PRINCIPALE CON CALENDARIO
function addDeposit() {
const depositList = document.getElementById('depositList');
const now = new Date();
const todayISO = now.toISOString().split('T')[0]; // es. "2026-02-03"
const depositDiv = document.createElement('div');
depositDiv.className = 'deposit-item';
depositDiv.innerHTML = `
<input type="date" class="deposit-date" value="${todayISO}" style="width: 120px; padding: 8px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px;">
<input type="text" class="deposit-amount" placeholder="Importo (‚Ç¨)" style="flex: 1; padding: 8px 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 15px;" oninput="calculateBalance()">
<button class="deposit-btn edit" onclick="editDeposit(this)">‚úèÔ∏è</button>
<button class="deposit-btn delete" onclick="deleteDeposit(this)">‚ùå</button>
`;
depositList.appendChild(depositDiv);
calculateBalance();
}

// Modifica acconto (attiva/disattiva editing)
function editDeposit(btn) {
const depositItem = btn.closest('.deposit-item');
const inputs = depositItem.querySelectorAll('input');
const isEditing = !inputs[0].readOnly;
if (isEditing) {
inputs.forEach(input => {
input.readOnly = true;
input.style.backgroundColor = '#f9f9f9';
});
btn.textContent = '‚úèÔ∏è';
} else {
inputs.forEach(input => {
input.readOnly = false;
input.style.backgroundColor = 'white';
});
btn.textContent = 'üíæ';
}
calculateBalance();
}

// Elimina acconto
function deleteDeposit(btn) {
const depositItem = btn.closest('.deposit-item');
depositItem.remove();
calculateBalance();
}

// Calcola saldo residuo
function calculateBalance() {
const importoText = document.getElementById('totaleComplessivo').textContent.trim().replace('‚Ç¨', '').replace(/\./g, '').replace(',', '.');
const importoTotale = parseFloat(importoText) || 0;
let totaleAcconti = 0;
document.querySelectorAll('.deposit-amount').forEach(input => {
const value = input.value.trim().replace('‚Ç¨', '').replace(/\./g, '').replace(',', '.');
const amount = parseFloat(value) || 0;
totaleAcconti += amount;
});
const saldo = importoTotale - totaleAcconti;
document.getElementById('saldoResiduo').textContent = `SALDO RESIDUO: ‚Ç¨ ${saldo.toFixed(2).replace('.', ',')}`;
}

// Calcola il totale complessivo (servizio + extra manuale)
function calculateTotal() {
const importoServizio = parseFloat(document.getElementById('importoServizio').value.replace(/\./g, '').replace(',', '.')) || 0;
const importoExtraManuale = parseFloat(document.getElementById('importoExtraManuale').value.replace(/\./g, '').replace(',', '.')) || 0;
const totaleComplessivo = importoServizio + importoExtraManuale;

document.getElementById('totaleComplessivo').textContent = totaleComplessivo.toFixed(2).replace('.', ',');
calculateBalance();
}

// Apri WhatsApp Web con il numero del cliente
function openWhatsAppWeb(phoneNumber, clientName) {
const cleanNumber = phoneNumber.replace(/\D/g, '');
if (cleanNumber.length < 8) {
alert('‚ö†Ô∏è Numero di telefono non valido per WhatsApp');
return;
}
const whatsappUrl = `https://web.whatsapp.com/send?phone=${cleanNumber}&text=Ciao ${encodeURIComponent(clientName)},%20`;
window.open(whatsappUrl, '_blank');
}

// Salva cliente (nuovo o modifica)
function saveClient() {
const cognome1 = document.getElementById('cognome1').value.trim();
const nome1 = document.getElementById('nome1').value.trim();
const telefono1 = document.getElementById('telefono1').value.trim();
const tipoServizio = document.getElementById('tipoServizio').value;
const dataEventoISO = document.getElementById('dataEvento').value;
const importoServizio = parseFloat(document.getElementById('importoServizio').value.replace(/\./g, '').replace(',', '.')) || 0;
const importoExtraManuale = parseFloat(document.getElementById('importoExtraManuale').value.replace(/\./g, '').replace(',', '.')) || 0;
if (!cognome1 || !nome1 || !telefono1) {
alert('‚ö†Ô∏è Compila almeno Cognome, Nome e Telefono del Cliente 1');
return;
}
if (!tipoServizio) {
alert('‚ö†Ô∏è Seleziona il Tipo di Servizio');
return;
}
if (!dataEventoISO) {
alert('‚ö†Ô∏è Inserisci la Data dell\'Evento');
return;
}
if (importoServizio <= 0) {
alert('‚ö†Ô∏è Inserisci un Importo Servizio valido');
return;
}

const dataEvento = formatDateISOtoDDMMYYYY(dataEventoISO);

const indirizzo1 = document.getElementById('indirizzo1').value.trim() || '';
const indirizzo2 = document.getElementById('indirizzo2').value.trim() || '';
const chiesa = document.getElementById('chiesa').value.trim() || '';
const location = document.getElementById('location').value.trim() || '';
const album = document.getElementById('album').value || '';
const copertina = document.getElementById('copertina').value || '';
const miniAlbum = document.getElementById('miniAlbum').value || '';
const effetti = document.getElementById('effetti').value || '';
const interni = document.getElementById('interni').value || '';
const fotoBook = document.getElementById('fotoBook').value || '';
const anteprima = document.getElementById('anteprima').value || '';
const postServizio = document.getElementById('postServizio').value || '';
const video = document.getElementById('video').value || '';
const tela = document.getElementById('tela').value || '';
const telaQt√† = document.getElementById('telaQt√†').value || '';
const stampeCarta = document.getElementById('stampeCarta').value || '';
const stampeQt√† = document.getElementById('stampeQt√†').value || '';
const miniPocket = document.getElementById('miniPocket').value || '';

// ‚úÖ VALORI AGGIORNATI CON "Nessuno"
const servizioSalaPosa = document.getElementById('servizioSalaPosa').value || '';
const servizioLocation = document.getElementById('servizioLocation').value || '';

const fotoExtraBook = document.getElementById('fotoExtraBook').value.trim() || '';
const servizioExtra = document.getElementById('servizioExtra').value.trim() || '';
const penninoUsb = document.getElementById('penninoUsb').value.trim() || '';

const importoTotale = importoServizio + importoExtraManuale;

// ‚úÖ RACCOLTA ACCONTI DAL MODULO PRINCIPALE CON CALENDARIO
const acconti = [];
document.querySelectorAll('.deposit-item').forEach(item => {
const dateInput = item.querySelector('.deposit-date');
const amountInput = item.querySelector('.deposit-amount');
const dateISO = dateInput.value.trim(); // es. "2026-06-19"
const date = formatDateISOtoDDMMYYYY(dateISO); // ‚Üí "19/06/2026"
const amountText = amountInput.value.trim().replace('‚Ç¨', '').replace(/\./g, '').replace(',', '.');
const amount = parseFloat(amountText);
if (date && amount > 0) {
acconti.push({
  date,
importo: amount.toFixed(2)
});
}
});

const cliente = {
id: isEditing ? currentClientId : Date.now(),
cognome1: cognome1 || '',
nome1: nome1 || '',
indirizzo1: indirizzo1,
telefono1: telefono1 || '',
email1: document.getElementById('email1').value.trim() || '',
cognome2: document.getElementById('cognome2').value.trim() || '',
nome2: document.getElementById('nome2').value.trim() || '',
indirizzo2: indirizzo2,
telefono2: document.getElementById('telefono2').value.trim() || '',
email2: document.getElementById('email2').value.trim() || '',
tipoServizio: tipoServizio || '',
chiesa: chiesa,
location: location,
dataEvento: dataEvento,
album: album,
copertina: copertina,
miniAlbum: miniAlbum,
effetti: effetti,
interni: interni,
fotoBook: fotoBook,
anteprima: anteprima,
postServizio: postServizio,
video: video,
tela: tela,
telaQt√†: telaQt√†,
stampeCarta: stampeCarta,
stampeQt√†: stampeQt√†,
miniPocket: miniPocket,
servizioSalaPosa: servizioSalaPosa, // ‚úÖ Pu√≤ essere "Nessuno"
servizioLocation: servizioLocation, // ‚úÖ Pu√≤ essere "Nessuno"
fotoExtraBook: fotoExtraBook,
servizioExtra: servizioExtra,
penninoUsb: penninoUsb,
importoServizio: importoServizio,
importoExtraManuale: importoExtraManuale,
importoTotale: importoTotale,
galleryEmail: document.getElementById('galleryEmail').value.trim() || '',
galleryUsername: document.getElementById('galleryUsername').value.trim() || '',
galleryPassword: document.getElementById('galleryPassword').value.trim() || '',
galleryUrl: document.getElementById('galleryUrl').value.trim() || '',
cartellaServizio: document.getElementById('cartellaServizio').value.trim() || '',
nota: document.getElementById('nota').value.trim() || '',
acconti: acconti,
dataSalvataggio: new Date().toISOString()
};

let clients = JSON.parse(localStorage.getItem('glStudioClients')) || [];

if (isEditing) {
const index = clients.findIndex(c => c.id === currentClientId);
if (index !== -1) {
clients[index] = cliente;
}
} else {
clients.push(cliente);
}

localStorage.setItem('glStudioClients', JSON.stringify(clients));
alert(isEditing ? '‚úÖ Cliente aggiornato con successo!' : '‚úÖ Cliente salvato con successo!');
loadClients();
resetForm();
isEditing = false;
currentClientId = null;
}

// Reset form
function resetForm() {
document.querySelectorAll('input:not([type="checkbox"]):not([type="radio"]), select, textarea').forEach(el => {
if (!el.id.startsWith('importo') && el.id !== 'totaleComplessivo') {
el.value = '';
}
});
// ‚úÖ Imposta "Nessuno" come valore predefinito
document.getElementById('servizioSalaPosa').value = '';
document.getElementById('servizioLocation').value = '';
document.getElementById('depositList').innerHTML = '';
document.getElementById('saldoResiduo').textContent = 'SALDO RESIDUO: ‚Ç¨ 0,00';
document.getElementById('totaleComplessivo').textContent = '0,00';
}

// ‚úÖ CARICA E VISUALIZZA CLIENTI ‚Äî CON DATA IN gg/mm/aaaa
function loadClients() {
const clients = JSON.parse(localStorage.getItem('glStudioClients')) || [];
const clientList = document.getElementById('clientList');
clientList.innerHTML = '';
if (clients.length === 0) {
clientList.innerHTML = '<p style="text-align: center; color: var(--gray-color); padding: 20px;">Nessun cliente salvato</p>';
return;
}
clients.sort((a, b) => {
const dateA = new Date(a.dataEvento.split('/').reverse().join('-'));
const dateB = new Date(b.dataEvento.split('/').reverse().join('-'));
return dateA - dateB;
});
clients.forEach(cliente => {
const totaleAcconti = cliente.acconti.reduce((sum, acc) => sum + parseFloat(acc.importo), 0);
const saldoResiduo = cliente.importoTotale - totaleAcconti;
const clientCard = document.createElement('div');
clientCard.className = 'client-card';
clientCard.innerHTML = `
<div class="client-card-header">
<div class="client-card-title">${cliente.cognome1} ${cliente.nome1}${cliente.cognome2 ? ' & ' + cliente.cognome2 : ''}</div>
<div class="client-card-date">${cliente.dataEvento}</div>
</div>
<div class="client-card-service">${cliente.tipoServizio} ‚Ä¢ ${cliente.dataEvento}</div>
<div class="client-card-amounts">
<span class="client-card-total">Totale: ‚Ç¨ ${cliente.importoTotale.toFixed(2).replace('.', ',')}</span>
<span class="client-card-deposits">Acconti: ‚Ç¨ ${totaleAcconti.toFixed(2).replace('.', ',')}</span>
<span class="client-card-balance">Saldo: ‚Ç¨ ${saldoResiduo.toFixed(2).replace('.', ',')}</span>
</div>
<div class="card-buttons" style="margin-top: 15px;">
<button class="card-btn open" onclick="showPdfView(${cliente.id})">Apri</button>
<button class="card-btn edit" onclick="editClient(${cliente.id})">‚úèÔ∏è Modifica</button>
<button class="card-btn pdf" onclick="generatePDF(${cliente.id})">üñ®Ô∏è PDF</button>
<button class="card-btn delete" onclick="deleteClient(${cliente.id})">‚ùå Elimina</button>
</div>
`;
clientList.appendChild(clientCard);
});
}

// Filtra clienti per ricerca
function filterClients() {
const searchTerm = document.getElementById('searchInput').value.toLowerCase().trim();
const clientCards = document.querySelectorAll('.client-card');
clientCards.forEach(card => {
const cardText = card.textContent.toLowerCase();
card.style.display = cardText.includes(searchTerm) ? 'block' : 'none';
});
}

// ‚úÖ MOSTRA LA SCHEDA PDF-LIKE ‚Äî CON DATA IN FORMATO CORRETTO
function showPdfView(clientId) {
const clients = JSON.parse(localStorage.getItem('glStudioClients')) || [];
const cliente = clients.find(c => c.id === clientId);
if (!cliente) return;

currentClientId = clientId;
const totaleAcconti = cliente.acconti.reduce((sum, acc) => sum + parseFloat(acc.importo), 0);
const saldoResiduo = cliente.importoTotale - totaleAcconti;

let content = `
<div style="text-align: center; border-bottom: 3px solid #e63946; padding-bottom: 15px; margin-bottom: 20px;">
<h1 style="color: #1d3557; font-size: 24px;">G&L Studio</h1>
<p style="color: #8d99ae;">Via Ciarrocco n.21, Canicatt√¨ (AG)</p>
</div>
<h2 style="color: #1d3557; text-align: center; margin: 20px 0;">SCHEDA CLIENTE</h2>
<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 25px;">
<div>
<h3 style="color: #1d3557; margin-bottom: 10px;">üë§ Cliente 1</h3>
<p><strong>Cognome:</strong> ${cliente.cognome1 || 'N/A'}</p>
<p><strong>Nome:</strong> ${cliente.nome1 || 'N/A'}</p>
<p><strong>Indirizzo:</strong> ${cliente.indirizzo1 || 'N/A'}</p>
<p><strong>Telefono:</strong> ${cliente.telefono1 || 'N/A'}
${cliente.telefono1 ? `<button onclick="openWhatsAppWeb('${cliente.telefono1}', '${cliente.nome1} ${cliente.cognome1}')" 
          class="whatsapp-btn" style="padding:4px 8px; font-size:12px; margin-left:8px;">
    üí¨ WhatsApp
  </button>` : ''}
</p>
<p><strong>Email:</strong> ${cliente.email1 || 'N/A'}</p>
</div>
${cliente.cognome2 ? `
<div>
<h3 style="color: #1d3557; margin-bottom: 10px;">üë§ Cliente 2</h3>
<p><strong>Cognome:</strong> ${cliente.cognome2 || 'N/A'}</p>
<p><strong>Nome:</strong> ${cliente.nome2 || 'N/A'}</p>
<p><strong>Indirizzo:</strong> ${cliente.indirizzo2 || 'N/A'}</p>
<p><strong>Telefono:</strong> ${cliente.telefono2 || 'N/A'}
${cliente.telefono2 ? `<button onclick="openWhatsAppWeb('${cliente.telefono2}', '${cliente.nome2} ${cliente.cognome2}')" 
          class="whatsapp-btn" style="padding:4px 8px; font-size:12px; margin-left:8px;">
    üí¨ WhatsApp
  </button>` : ''}
</p>
<p><strong>Email:</strong> ${cliente.email2 || 'N/A'}</p>
</div>` : ''}
</div>

<div style="background-color: rgba(230, 57, 70, 0.1); padding: 15px; border-radius: 8px; text-align: center; font-weight: bold; font-size: 18px; margin: 25px 0;">
LAVORO COMMISSIONATO
</div>

<div style="margin-bottom: 20px;">
<h3 style="color: #1d3557; margin-bottom: 10px;">Dettagli Servizio</h3>
<p><strong>1. Tipo di Servizio:</strong> ${cliente.tipoServizio || 'N/A'}</p>
<p><strong>2. Chiesa:</strong> ${cliente.chiesa || 'N/A'}</p>
<p><strong>3. Location:</strong> ${cliente.location || 'N/A'}</p>
<p><strong>4. Data Evento:</strong> ${cliente.dataEvento}</p>
<p><strong>5. Album:</strong> ${cliente.album || 'N/A'}</p>
<p><strong>6. Copertina:</strong> ${cliente.copertina || 'N/A'}</p>
<p><strong>7. Mini Album:</strong> ${cliente.miniAlbum || 'N/A'}</p>
<p><strong>8. Effetti:</strong> ${cliente.effetti || 'N/A'}</p>
<p><strong>9. Interni:</strong> ${cliente.interni || 'N/A'}</p>
<p><strong>10. Foto selezionate per book:</strong> ${cliente.fotoBook || 'N/A'}</p>
<p><strong>11. Anteprima:</strong> ${cliente.anteprima || 'N/A'}</p>
<p><strong>12. Post Servizio:</strong> ${cliente.postServizio || 'N/A'}</p>
<p><strong>13. Video:</strong> ${cliente.video || 'N/A'}</p>
<p><strong>14. Tela:</strong> ${cliente.tela || 'N/A'} (Qt√†: ${cliente.telaQt√† || '0'})</p>
<p><strong>15. Stampe Carta Fotografica:</strong> ${cliente.stampeCarta || 'N/A'} (Qt√†: ${cliente.stampeQt√† || '0'})</p>
<p><strong>16. Mini Pocket:</strong> ${cliente.miniPocket || 'N/A'}</p>
<p><strong>17. Servizio Sala Posa:</strong> ${cliente.servizioSalaPosa || 'Nessuno'}</p>
<p><strong>18. Servizio Location:</strong> ${cliente.servizioLocation || 'Nessuno'}</p>
</div>

<div style="margin-bottom: 20px; padding: 15px; background-color: #f0f8ff; border-radius: 8px;">
<h3 style="color: #1d3557; margin-bottom: 10px; text-align: center;">Richieste EXTRA</h3>
${cliente.fotoExtraBook ? `<p><strong>Foto extra in book:</strong> ${cliente.fotoExtraBook}</p>` : ''}
${cliente.servizioExtra ? `<p><strong>Servizio extra:</strong> ${cliente.servizioExtra}</p>` : ''}
${cliente.penninoUsb ? `<p><strong>Pennino USB:</strong> ${cliente.penninoUsb}</p>` : ''}
</div>

${cliente.galleryEmail || cliente.galleryUsername || cliente.galleryPassword || cliente.galleryUrl ? `
<div style="margin-bottom: 20px; padding: 15px; background-color: #f8f9fa; border-radius: 8px;">
<h3 style="color: #1d3557; margin-bottom: 10px;">APP. GALLERY</h3>
${cliente.galleryEmail ? `<p><strong>Email:</strong> ${cliente.galleryEmail}</p>` : ''}
${cliente.galleryUsername ? `<p><strong>Username:</strong> ${cliente.galleryUsername}</p>` : ''}
${cliente.galleryPassword ? `<p><strong>Password:</strong> ${cliente.galleryPassword}</p>` : ''}
${cliente.galleryUrl ? `<p><strong>URL:</strong> <a href="${cliente.galleryUrl}" target="_blank">${cliente.galleryUrl}</a></p>` : ''}
</div>` : ''}

${cliente.cartellaServizio ? `
<div style="margin-bottom: 15px;">
<p><strong>Cartella servizio in:</strong> ${cliente.cartellaServizio}</p>
</div>` : ''}

${cliente.nota ? `
<div style="margin-bottom: 20px;">
<h3 style="color: #1d3557; margin-bottom: 10px;">NOTA</h3>
<p style="white-space: pre-wrap;">${cliente.nota}</p>
</div>` : ''}

<div style="text-align: center; margin: 30px 0; padding: 20px; background-color: rgba(230, 57, 70, 0.1); border-radius: 12px;">
<p style="font-size: 24px; font-weight: bold; color: #e63946; margin-bottom: 10px;">IMPORTO TOTALE COMPLESSIVO</p>
<p style="font-size: 28px; font-weight: bold; color: #e63946;">‚Ç¨ ${cliente.importoTotale.toFixed(2).replace('.', ',')}</p>
</div>

<div style="margin-bottom: 20px;">
<h3 style="color: #1d3557; margin-bottom: 10px;">Acconti Ricevuti</h3>
${cliente.acconti.length > 0 ? cliente.acconti.map(acc => `
<p style="margin: 5px 0;">${acc.date} - ‚Ç¨ ${parseFloat(acc.importo).toFixed(2).replace('.', ',')}</p>
`).join('') : '<p>Nessun acconto registrato</p>'}
</div>

<div style="text-align: center; font-size: 22px; font-weight: bold; color: #e63946; padding: 15px; background-color: rgba(230, 57, 70, 0.1); border-radius: 8px;">
SALDO RESIDUO: ‚Ç¨ ${saldoResiduo.toFixed(2).replace('.', ',')}
</div>

<div style="margin-top: 30px; text-align: center; font-size: 14px; color: #8d99ae;">
<p>G&L Studio - Via Ciarrocco n.21, Canicatt√¨ (AG)</p>
<p>Tel: +39 366 9381103 / 320 6337370 | Email: weddinggel@aruba.it</p>
</div>
`;

document.getElementById('pdfContent').innerHTML = content;
document.getElementById('pdfView').style.display = 'block';
document.querySelector('.form-section').style.display = 'none';
document.querySelector('.client-list').closest('.form-section').style.display = 'none';
}

// Nascondi la scheda PDF-like
function hidePdfView() {
document.getElementById('pdfView').style.display = 'none';
document.querySelector('.form-section').style.display = 'block';
document.querySelector('.client-list').closest('.form-section').style.display = 'block';
}

// Modifica dal PDF view
function editFromPdfView() {
hidePdfView();
editClient(currentClientId);
}

// Stampa la scheda PDF-like
function printPdfView() {
window.print();
}

// Modifica cliente (carica dati nel form)
function editClient(clientId) {
const clients = JSON.parse(localStorage.getItem('glStudioClients')) || [];
const cliente = clients.find(c => c.id === clientId);
if (!cliente) return;

isEditing = true;
currentClientId = clientId;

document.getElementById('cognome1').value = cliente.cognome1 || '';
document.getElementById('nome1').value = cliente.nome1 || '';
document.getElementById('indirizzo1').value = cliente.indirizzo1 || '';
document.getElementById('telefono1').value = cliente.telefono1 || '';
document.getElementById('email1').value = cliente.email1 || '';
document.getElementById('cognome2').value = cliente.cognome2 || '';
document.getElementById('nome2').value = cliente.nome2 || '';
document.getElementById('indirizzo2').value = cliente.indirizzo2 || '';
document.getElementById('telefono2').value = cliente.telefono2 || '';
document.getElementById('email2').value = cliente.email2 || '';
document.getElementById('tipoServizio').value = cliente.tipoServizio || '';
document.getElementById('chiesa').value = cliente.chiesa || '';
document.getElementById('location').value = cliente.location || '';
const [d, m, y] = cliente.dataEvento.split('/');
document.getElementById('dataEvento').value = `${y}-${m}-${d}`;
document.getElementById('album').value = cliente.album || '';
document.getElementById('copertina').value = cliente.copertina || '';
document.getElementById('miniAlbum').value = cliente.miniAlbum || '';
document.getElementById('effetti').value = cliente.effetti || '';
document.getElementById('interni').value = cliente.interni || '';
document.getElementById('fotoBook').value = cliente.fotoBook || '';
document.getElementById('anteprima').value = cliente.anteprima || '';
document.getElementById('postServizio').value = cliente.postServizio || '';
document.getElementById('video').value = cliente.video || '';
document.getElementById('tela').value = cliente.tela || '';
document.getElementById('telaQt√†').value = cliente.telaQt√† || '';
document.getElementById('stampeCarta').value = cliente.stampeCarta || '';
document.getElementById('stampeQt√†').value = cliente.stampeQt√† || '';
document.getElementById('miniPocket').value = cliente.miniPocket || '';

// ‚úÖ Carica valori corretti (incluso "Nessuno" = stringa vuota)
document.getElementById('servizioSalaPosa').value = cliente.servizioSalaPosa || '';
document.getElementById('servizioLocation').value = cliente.servizioLocation || '';

document.getElementById('fotoExtraBook').value = cliente.fotoExtraBook || '';
document.getElementById('servizioExtra').value = cliente.servizioExtra || '';
document.getElementById('penninoUsb').value = cliente.penninoUsb || '';
document.getElementById('importoServizio').value = cliente.importoServizio.toFixed(2).replace('.', ',');
document.getElementById('importoExtraManuale').value = cliente.importoExtraManuale.toFixed(2).replace('.', ',');
document.getElementById('galleryEmail').value = cliente.galleryEmail || '';
document.getElementById('galleryUsername').value = cliente.galleryUsername || '';
document.getElementById('galleryPassword').value = cliente.galleryPassword || '';
document.getElementById('galleryUrl').value = cliente.galleryUrl || '';
document.getElementById('cartellaServizio').value = cliente.cartellaServizio || '';
document.getElementById('nota').value = cliente.nota || '';

const depositList = document.getElementById('depositList');
depositList.innerHTML = '';
cliente.acconti.forEach(acc => {
const [dd, mm, yy] = acc.date.split('/');
const isoDate = `${yy}-${mm}-${dd}`;
const depositDiv = document.createElement('div');
depositDiv.className = 'deposit-item';
depositDiv.innerHTML = `
<input type="date" class="deposit-date" value="${isoDate}" style="width: 120px; padding: 8px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px;" readonly>
<input type="text" class="deposit-amount" value="${parseFloat(acc.importo).toFixed(2).replace('.', ',')} ‚Ç¨" style="flex: 1; padding: 8px 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 15px;" readonly>
<button class="deposit-btn edit" onclick="editDeposit(this)">‚úèÔ∏è</button>
<button class="deposit-btn delete" onclick="deleteDeposit(this)">‚ùå</button>
`;
depositList.appendChild(depositDiv);
});

window.scrollTo({ top: 0, behavior: 'smooth' });
}

// Elimina cliente
function deleteClient(clientId) {
if (!confirm('‚ö†Ô∏è Sei sicuro di eliminare questo cliente? Questa azione √® irreversibile.')) return;
let clients = JSON.parse(localStorage.getItem('glStudioClients')) || [];
clients = clients.filter(c => c.id !== clientId);
localStorage.setItem('glStudioClients', JSON.stringify(clients));
alert('‚úÖ Cliente eliminato con successo');
loadClients();
}

// Apri Google Maps
function openMaps(fieldId) {
const address = document.getElementById(fieldId).value.trim();
if (!address) {
alert('‚ö†Ô∏è Inserisci prima un indirizzo');
return;
}
window.open(`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(address)}`, '_blank');
}

// Genera PDF della scheda cliente
async function generatePDF(clientId) {
const clients = JSON.parse(localStorage.getItem('glStudioClients')) || [];
const cliente = clients.find(c => c.id === clientId);
if (!cliente) {
alert('Cliente non trovato');
return;
}
try {
const printSection = document.createElement('div');
printSection.id = 'printSection';
printSection.style.padding = '20px';
printSection.style.fontFamily = "'Segoe UI', Tahoma, Geneva, Verdana, sans-serif";
printSection.style.maxWidth = '800px';
printSection.style.margin = '0 auto';

const totaleAcconti = cliente.acconti.reduce((sum, acc) => sum + parseFloat(acc.importo), 0);
const saldoResiduo = cliente.importoTotale - totaleAcconti;

printSection.innerHTML = `
<div style="text-align: center; border-bottom: 3px solid #e63946; padding-bottom: 15px; margin-bottom: 20px;">
<h1 style="color: #1d3557; font-size: 24px;">G&L Studio</h1>
<p style="color: #8d99ae;">Via Ciarrocco n.21, Canicatt√¨ (AG)</p>
</div>
<h2 style="color: #1d3557; text-align: center; margin: 20px 0;">SCHEDA CLIENTE</h2>
<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 25px;">
<div>
<h3 style="color: #1d3557; margin-bottom: 10px;">üë§ Cliente 1</h3>
<p><strong>Cognome:</strong> ${cliente.cognome1 || 'N/A'}</p>
<p><strong>Nome:</strong> ${cliente.nome1 || 'N/A'}</p>
<p><strong>Indirizzo:</strong> ${cliente.indirizzo1 || 'N/A'}</p>
<p><strong>Telefono:</strong> ${cliente.telefono1 || 'N/A'}
${cliente.telefono1 ? `<button onclick="openWhatsAppWeb('${cliente.telefono1}', '${cliente.nome1} ${cliente.cognome1}')" 
          class="whatsapp-btn" style="padding:4px 8px; font-size:12px; margin-left:8px;">
    üí¨ WhatsApp
  </button>` : ''}
</p>
<p><strong>Email:</strong> ${cliente.email1 || 'N/A'}</p>
</div>
${cliente.cognome2 ? `
<div>
<h3 style="color: #1d3557; margin-bottom: 10px;">üë§ Cliente 2</h3>
<p><strong>Cognome:</strong> ${cliente.cognome2 || 'N/A'}</p>
<p><strong>Nome:</strong> ${cliente.nome2 || 'N/A'}</p>
<p><strong>Indirizzo:</strong> ${cliente.indirizzo2 || 'N/A'}</p>
<p><strong>Telefono:</strong> ${cliente.telefono2 || 'N/A'}
${cliente.telefono2 ? `<button onclick="openWhatsAppWeb('${cliente.telefono2}', '${cliente.nome2} ${cliente.cognome2}')" 
          class="whatsapp-btn" style="padding:4px 8px; font-size:12px; margin-left:8px;">
    üí¨ WhatsApp
  </button>` : ''}
</p>
<p><strong>Email:</strong> ${cliente.email2 || 'N/A'}</p>
</div>` : ''}
</div>

<div style="background-color: rgba(230, 57, 70, 0.1); padding: 15px; border-radius: 8px; text-align: center; font-weight: bold; font-size: 18px; margin: 25px 0;">
LAVORO COMMISSIONATO
</div>

<div style="margin-bottom: 20px;">
<h3 style="color: #1d3557; margin-bottom: 10px;">Dettagli Servizio</h3>
<p><strong>1. Tipo di Servizio:</strong> ${cliente.tipoServizio || 'N/A'}</p>
<p><strong>2. Chiesa:</strong> ${cliente.chiesa || 'N/A'}</p>
<p><strong>3. Location:</strong> ${cliente.location || 'N/A'}</p>
<p><strong>4. Data Evento:</strong> ${cliente.dataEvento}</p>
<p><strong>5. Album:</strong> ${cliente.album || 'N/A'}</p>
<p><strong>6. Copertina:</strong> ${cliente.copertina || 'N/A'}</p>
<p><strong>7. Mini Album:</strong> ${cliente.miniAlbum || 'N/A'}</p>
<p><strong>8. Effetti:</strong> ${cliente.effetti || 'N/A'}</p>
<p><strong>9. Interni:</strong> ${cliente.interni || 'N/A'}</p>
<p><strong>10. Foto selezionate per book:</strong> ${cliente.fotoBook || 'N/A'}</p>
<p><strong>11. Anteprima:</strong> ${cliente.anteprima || 'N/A'}</p>
<p><strong>12. Post Servizio:</strong> ${cliente.postServizio || 'N/A'}</p>
<p><strong>13. Video:</strong> ${cliente.video || 'N/A'}</p>
<p><strong>14. Tela:</strong> ${cliente.tela || 'N/A'} (Qt√†: ${cliente.telaQt√† || '0'})</p>
<p><strong>15. Stampe Carta Fotografica:</strong> ${cliente.stampeCarta || 'N/A'} (Qt√†: ${cliente.stampeQt√† || '0'})</p>
<p><strong>16. Mini Pocket:</strong> ${cliente.miniPocket || 'N/A'}</p>
<p><strong>17. Servizio Sala Posa:</strong> ${cliente.servizioSalaPosa || 'Nessuno'}</p>
<p><strong>18. Servizio Location:</strong> ${cliente.servizioLocation || 'Nessuno'}</p>
</div>

<div style="margin-bottom: 20px; padding: 15px; background-color: #f0f8ff; border-radius: 8px;">
<h3 style="color: #1d3557; margin-bottom: 10px; text-align: center;">Richieste EXTRA</h3>
${cliente.fotoExtraBook ? `<p><strong>Foto extra in book:</strong> ${cliente.fotoExtraBook}</p>` : ''}
${cliente.servizioExtra ? `<p><strong>Servizio extra:</strong> ${cliente.servizioExtra}</p>` : ''}
${cliente.penninoUsb ? `<p><strong>Pennino USB:</strong> ${cliente.penninoUsb}</p>` : ''}
</div>

${cliente.galleryEmail || cliente.galleryUsername || cliente.galleryPassword || cliente.galleryUrl ? `
<div style="margin-bottom: 20px; padding: 15px; background-color: #f8f9fa; border-radius: 8px;">
<h3 style="color: #1d3557; margin-bottom: 10px;">APP. GALLERY</h3>
${cliente.galleryEmail ? `<p><strong>Email:</strong> ${cliente.galleryEmail}</p>` : ''}
${cliente.galleryUsername ? `<p><strong>Username:</strong> ${cliente.galleryUsername}</p>` : ''}
${cliente.galleryPassword ? `<p><strong>Password:</strong> ${cliente.galleryPassword}</p>` : ''}
${cliente.galleryUrl ? `<p><strong>URL:</strong> <a href="${cliente.galleryUrl}" target="_blank">${cliente.galleryUrl}</a></p>` : ''}
</div>` : ''}

${cliente.cartellaServizio ? `
<div style="margin-bottom: 15px;">
<p><strong>Cartella servizio in:</strong> ${cliente.cartellaServizio}</p>
</div>` : ''}

${cliente.nota ? `
<div style="margin-bottom: 20px;">
<h3 style="color: #1d3557; margin-bottom: 10px;">NOTA</h3>
<p style="white-space: pre-wrap;">${cliente.nota}</p>
</div>` : ''}

<div style="text-align: center; margin: 30px 0; padding: 20px; background-color: rgba(230, 57, 70, 0.1); border-radius: 12px;">
<p style="font-size: 24px; font-weight: bold; color: #e63946; margin-bottom: 10px;">IMPORTO TOTALE COMPLESSIVO</p>
<p style="font-size: 28px; font-weight: bold; color: #e63946;">‚Ç¨ ${cliente.importoTotale.toFixed(2).replace('.', ',')}</p>
</div>

<div style="margin-bottom: 20px;">
<h3 style="color: #1d3557; margin-bottom: 10px;">Acconti Ricevuti</h3>
${cliente.acconti.length > 0 ? cliente.acconti.map(acc => `
<p style="margin: 5px 0;">${acc.date} - ‚Ç¨ ${parseFloat(acc.importo).toFixed(2).replace('.', ',')}</p>
`).join('') : '<p>Nessun acconto registrato</p>'}
</div>

<div style="text-align: center; font-size: 22px; font-weight: bold; color: #e63946; padding: 15px; background-color: rgba(230, 57, 70, 0.1); border-radius: 8px;">
SALDO RESIDUO: ‚Ç¨ ${saldoResiduo.toFixed(2).replace('.', ',')}
</div>

<div style="margin-top: 30px; text-align: center; font-size: 14px; color: #8d99ae;">
<p>G&L Studio - Via Ciarrocco n.21, Canicatt√¨ (AG)</p>
<p>Tel: +39 366 9381103 / 320 6337370 | Email: weddinggel@aruba.it</p>
</div>
`;

document.body.appendChild(printSection);

const pdf = new jsPDF('p', 'mm', 'a4');
const canvas = await html2canvas(printSection, {
scale: 2,
useCORS: true,
logging: false
});
const imgData = canvas.toDataURL('image/png');
const imgWidth = 190;
const pageHeight = 295;
const imgHeight = canvas.height * imgWidth / canvas.width;
let heightLeft = imgHeight;
let position = 10;
pdf.addImage(imgData, 'PNG', 10, position, imgWidth, imgHeight);
heightLeft -= pageHeight;
while (heightLeft >= 0) {
position = heightLeft - imgHeight;
pdf.addPage();
pdf.addImage(imgData, 'PNG', 10, position, imgWidth, imgHeight);
heightLeft -= pageHeight;
}
pdf.save(`G&L_Studio_Cliente_${cliente.cognome1}_${cliente.dataEvento}.pdf`);

document.body.removeChild(printSection);
} catch (error) {
console.error('Errore generazione PDF:', error);
alert('‚ùå Errore durante la generazione del PDF. Riprova.');
}
}

// Backup dati (SOLO file aggiornato)
function downloadBackup(auto = false) {
const clients = JSON.parse(localStorage.getItem('glStudioClients')) || [];
if (clients.length === 0) {
alert('Nessun dato da esportare');
return;
}
const backupData = {
version: 'G&L Studio v1.0',
exportDate: new Date().toISOString(),
clients: clients
};
const filename = `gl-studio-clienti.json`;
const blob = new Blob([JSON.stringify(backupData, null, 2)], { type: 'application/json' });
const url = URL.createObjectURL(blob);
const a = document.createElement('a');
a.href = url;
a.download = filename;
document.body.appendChild(a);
a.click();
document.body.removeChild(a);
URL.revokeObjectURL(url);
if (!auto) {
alert(`‚úÖ Backup salvato: ${filename}`);
}
}

// Ripristina da file
function restoreBackup() {
const input = document.createElement('input');
input.type = 'file';
input.accept = '.json';
input.onchange = e => {
const file = e.target.files[0];
if (!file) return;
const reader = new FileReader();
reader.onload = event => {
try {
const data = JSON.parse(event.target.result);
if (!data.clients) {
alert('‚ùå File non valido: struttura dati non riconosciuta');
return;
}
if (!confirm(`‚ö†Ô∏è Questa operazione sovrascriver√† tutti i clienti esistenti (${data.clients.length} clienti nel file). Procedere?`)) {
return;
}
localStorage.setItem('glStudioClients', JSON.stringify(data.clients));
alert(`‚úÖ Backup ripristinato con successo (${data.clients.length} clienti)`);
loadClients();
} catch (error) {
console.error('Errore ripristino:', error);
alert('‚ùå Errore durante il ripristino del file');
}
};
reader.readAsText(file);
};
input.click();
}
</script>
</body>
</html>
